(()=>{"use strict";const t=t=>{let e=(()=>{const t=[],e=[];for(let e=0;e<10;e++){t[e]=[];for(let r=0;r<10;r++)t[e].push(!1)}function r(e,r,o,i){if("h"===i){if(o+e>10)return!1;for(let i=0;i<e;i++)if(t[r][o+i].hasOwnProperty("ship"))return!1;return!0}if("v"===i){if(r+e>10)return!1;for(let i=0;i<e;i++)if(t[r+i][o].hasOwnProperty("ship"))return!1;return!0}}return{board:t,missedShots:e,placeShip:(e,o,i,s)=>{const a=(t=>{const e=[];for(let r=0;r<t;r++)e.push({hit:!1});const r=e.length;return{shipArr:e,getLength:r,hit:t=>(e[t].hit=!0,e),isSunk:()=>{if(e.every((t=>1==t.hit)))return!0},domTargets:[]}})(e);let l=0;if(t[o][i])return!1;if("h"===s&&r(e,o,i,s))for(let r=0;r<e;r++)t[o][i+r]={ship:a,shipPos:l},l++;else{if("v"!==s||!r(e,o,i,s))return!1;for(let r=0;r<e;r++)t[o+r][i]={ship:a,shipPos:l},l++}},receiveAttack:(r,o)=>{if(t[r][o].hasOwnProperty("ship")){let e=t[r][o].shipPos;return t[r][o].ship.hit(e),e="hit",e}return t[r][o]="miss",e.push([r,o]),t[r][o]},allShipsSunk:()=>{let e=[];for(let r of t)for(let t of r)t.hasOwnProperty("ship")&&e.push(t.ship.isSunk());return e.every((t=>1==t))}}})(),r=!1;function o(t){let r=Math.floor(10*Math.random()),o=Math.floor(10*Math.random()),i=Math.round(Math.random());return(0!==i||(i="h",0!=e.placeShip(r,o,t,i)))&&(1!==i||(i="v",0!=e.placeShip(r,o,t,i)))&&void 0}return{name:t,board:e,playerTurn:t=>{r=!0,t.turn=!1},atk:(t,e,r)=>t.board.receiveAttack(e,r),randFleet:()=>{for(let t=0;t<2;)0!=o(1)&&t++;for(let t=0;t<2;)0!=o(2)&&t++;for(let t=0;t<2;)0!=o(3)&&t++;for(let t=0;t<2;)0!=o(4)&&t++}}};function e(t,e,r,o,i){let s=o.atk(i,e,r);if(s)return"miss"===s&&t.target.classList.add("miss"),"hit"===s?(t.target.classList.add("hit"),i.board.board[e][r].ship.domTargets.push(t.target),void(i.board.board[e][r].ship.isSunk()&&i.board.board[e][r].ship.domTargets.forEach((t=>t.classList.add("sunk"))))):void 0}let r=t("me"),o=t("ai");!function(t,r){for(let e=0;e<10;e++){let r=document.createElement("div");r.classList.add("row-p1"),r.setAttribute("id",`p1-row${e}`),document.querySelector(".player-board").appendChild(r),t.board.board[e].forEach(((t,o)=>{let i=document.createElement("div");i.classList.add("cell-p1"),i.setAttribute("id",`p1-row${e}-cell${o}`),r.appendChild(i)}))}for(let o=0;o<10;o++){let i=document.createElement("div");i.classList.add("row-p2"),i.setAttribute("id",`p2-row${o}`),document.querySelector(".op-board").appendChild(i),r.board.board[o].forEach(((s,a)=>{let l=document.createElement("div");l.classList.add("cell-p2"),l.setAttribute("id",`p2-row${o}-cell${a}`),i.appendChild(l),l.addEventListener("click",(i=>{e(i,o,a,t,r)}))}))}}(r,o),r.randFleet(),o.randFleet(),function(t){document.querySelectorAll(".cell-p1").forEach(((e,r)=>{let o,i,s=""+r;r<10?(o=0,i=r):(s=s.split(""),o=s[0],i=s[1]),t.board.board[o][i]&&e.classList.add("fleet")}))}(r)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEdBQy9CLEdBRU4sQ0FDRixDQzNCQWEsQ0FBYWQsRUFBSUMsR0FDakJELEVBQUdMLFlBQ0hNLEVBQUdOLFlEMkJILFNBQXFCRCxHQUNuQmEsU0FBU1EsaUJBQWlCLFlBQVlULFNBQVEsQ0FBQ1QsRUFBR3JDLEtBQ2hELElBQUlLLEVBQUdDLEVBQ0hTLEVBQU0sR0FBS2YsRUFFWEEsRUFBSSxJQUNOSyxFQUFJLEVBQ0pDLEVBQUlOLElBRUplLEVBQU1BLEVBQUl5QyxNQUFNLElBQ2hCbkQsRUFBSVUsRUFBSSxHQUNSVCxFQUFJUyxFQUFJLElBR0xtQixFQUFPcEMsTUFBTUEsTUFBTU8sR0FBR0MsSUFDdEIrQixFQUFFTyxVQUFVQyxJQUFJLFFBQVEsR0FFakMsQ0MzQ0FZLENBQVlqQixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9zaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvcGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZWJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvRE9NLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU2hpcCA9IChzaXplKSA9PiB7XG4gIGNvbnN0IHNoaXBBcnIgPSBbXTtcbiAgbGV0IGRvbVRhcmdldHMgPSBbXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHtcbiAgICBzaGlwQXJyLnB1c2goeyBoaXQ6IGZhbHNlIH0pO1xuICB9XG5cbiAgY29uc3QgZ2V0TGVuZ3RoID0gc2hpcEFyci5sZW5ndGg7XG5cbiAgY29uc3QgaGl0ID0gKHBvcykgPT4ge1xuICAgIHNoaXBBcnJbcG9zXS5oaXQgPSB0cnVlO1xuICAgIHJldHVybiBzaGlwQXJyO1xuICB9O1xuXG4gIGNvbnN0IGlzU3VuayA9ICgpID0+IHtcbiAgICBpZiAoc2hpcEFyci5ldmVyeSgoeCkgPT4geC5oaXQgPT0gdHJ1ZSkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4geyBzaGlwQXJyLCBnZXRMZW5ndGgsIGhpdCwgaXNTdW5rLCBkb21UYXJnZXRzIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBTaGlwO1xuIiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tIFwiLi9nYW1lYm9hcmRcIjtcblxuY29uc3QgUGxheWVyID0gKG5hbWUpID0+IHtcbiAgbGV0IGJvYXJkID0gR2FtZWJvYXJkKCk7XG4gIGxldCB0dXJuID0gZmFsc2U7XG5cbiAgbGV0IHBsYXllclR1cm4gPSAob3ApID0+IHtcbiAgICB0dXJuID0gdHJ1ZTtcbiAgICBvcC50dXJuID0gZmFsc2U7XG4gIH07XG5cbiAgbGV0IGF0ayA9IChwbGF5ZXIsIHgsIHkpID0+IHtcbiAgICByZXR1cm4gcGxheWVyLmJvYXJkLnJlY2VpdmVBdHRhY2soeCwgeSk7XG4gIH07XG5cbiAgZnVuY3Rpb24gcmFuZFNoaXAobGVuZ3RoKSB7XG4gICAgbGV0IHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgbGV0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgbGV0IGRpciA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSk7XG5cbiAgICBpZiAoZGlyID09PSAwKSB7XG4gICAgICBkaXIgPSBcImhcIjtcbiAgICAgIGlmIChib2FyZC5wbGFjZVNoaXAoeCwgeSwgbGVuZ3RoLCBkaXIpID09IGZhbHNlKSByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKGRpciA9PT0gMSkge1xuICAgICAgZGlyID0gXCJ2XCI7XG4gICAgICBpZiAoYm9hcmQucGxhY2VTaGlwKHgsIHksIGxlbmd0aCwgZGlyKSA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGxldCByYW5kRmxlZXQgPSAoKSA9PiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyOyApIHtcbiAgICAgIGlmIChyYW5kU2hpcCgxKSA9PSBmYWxzZSkgY29udGludWU7XG4gICAgICBpKys7XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjsgKSB7XG4gICAgICBpZiAocmFuZFNoaXAoMikgPT0gZmFsc2UpIGNvbnRpbnVlO1xuICAgICAgaSsrO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI7ICkge1xuICAgICAgaWYgKHJhbmRTaGlwKDMpID09IGZhbHNlKSBjb250aW51ZTtcbiAgICAgIGkrKztcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyOyApIHtcbiAgICAgIGlmIChyYW5kU2hpcCg0KSA9PSBmYWxzZSkgY29udGludWU7XG4gICAgICBpKys7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiB7IG5hbWUsIGJvYXJkLCBwbGF5ZXJUdXJuLCBhdGssIHJhbmRGbGVldCB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgUGxheWVyO1xuIiwiaW1wb3J0IFNoaXAgZnJvbSBcIi4vc2hpcFwiO1xuXG5jb25zdCBHYW1lYm9hcmQgPSAoKSA9PiB7XG4gIGNvbnN0IGJvYXJkID0gW107XG4gIGNvbnN0IG1pc3NlZFNob3RzID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgIGJvYXJkW2ldID0gW107XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCAxMDsgaisrKSB7XG4gICAgICBib2FyZFtpXS5wdXNoKGZhbHNlKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB2YWxpZFBsYWNlbWVudChsZW5ndGgsIHgsIHksIGRpcikge1xuICAgIGlmIChkaXIgPT09IFwiaFwiKSB7XG4gICAgICBpZiAoeSArIGxlbmd0aCA+IDEwKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGJvYXJkW3hdW3kgKyBpXS5oYXNPd25Qcm9wZXJ0eShcInNoaXBcIikpIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChkaXIgPT09IFwidlwiKSB7XG4gICAgICBpZiAoeCArIGxlbmd0aCA+IDEwKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGJvYXJkW3ggKyBpXVt5XS5oYXNPd25Qcm9wZXJ0eShcInNoaXBcIikpIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgcGxhY2VTaGlwID0gKGxlbmd0aCwgeCwgeSwgZGlyKSA9PiB7XG4gICAgY29uc3Qgc2hpcCA9IFNoaXAobGVuZ3RoKTtcbiAgICBsZXQgc2hpcFBvcyA9IDA7XG5cbiAgICBpZiAoYm9hcmRbeF1beV0pIHJldHVybiBmYWxzZTtcblxuICAgIGlmIChkaXIgPT09IFwiaFwiICYmIHZhbGlkUGxhY2VtZW50KGxlbmd0aCwgeCwgeSwgZGlyKSkge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICBib2FyZFt4XVt5ICsgaV0gPSB7IHNoaXAsIHNoaXBQb3MgfTtcbiAgICAgICAgc2hpcFBvcysrO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZGlyID09PSBcInZcIiAmJiB2YWxpZFBsYWNlbWVudChsZW5ndGgsIHgsIHksIGRpcikpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYm9hcmRbeCArIGldW3ldID0geyBzaGlwLCBzaGlwUG9zIH07XG4gICAgICAgIHNoaXBQb3MrKztcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKHgsIHkpID0+IHtcbiAgICBpZiAoYm9hcmRbeF1beV0uaGFzT3duUHJvcGVydHkoXCJzaGlwXCIpKSB7XG4gICAgICBsZXQgc2hpcFBvcyA9IGJvYXJkW3hdW3ldLnNoaXBQb3M7XG4gICAgICBib2FyZFt4XVt5XS5zaGlwLmhpdChzaGlwUG9zKTtcblxuICAgICAgc2hpcFBvcyA9IFwiaGl0XCI7XG4gICAgICByZXR1cm4gc2hpcFBvcztcbiAgICB9IGVsc2Uge1xuICAgICAgYm9hcmRbeF1beV0gPSBcIm1pc3NcIjtcbiAgICAgIG1pc3NlZFNob3RzLnB1c2goW3gsIHldKTtcblxuICAgICAgcmV0dXJuIGJvYXJkW3hdW3ldO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBhbGxTaGlwc1N1bmsgPSAoKSA9PiB7XG4gICAgbGV0IGNoZWNrU2hpcHMgPSBbXTtcbiAgICBmb3IgKGxldCByb3cgb2YgYm9hcmQpIHtcbiAgICAgIGZvciAobGV0IHNwYWNlIG9mIHJvdykge1xuICAgICAgICBpZiAoc3BhY2UuaGFzT3duUHJvcGVydHkoXCJzaGlwXCIpKSB7XG4gICAgICAgICAgY2hlY2tTaGlwcy5wdXNoKHNwYWNlLnNoaXAuaXNTdW5rKCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjaGVja1NoaXBzLmV2ZXJ5KChzaGlwKSA9PiBzaGlwID09IHRydWUpO1xuICB9O1xuXG4gIHJldHVybiB7IGJvYXJkLCBtaXNzZWRTaG90cywgcGxhY2VTaGlwLCByZWNlaXZlQXR0YWNrLCBhbGxTaGlwc1N1bmsgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEdhbWVib2FyZDtcbiIsImZ1bmN0aW9uIHJlbmRlckJvYXJkcyhwMSwgcDIpIHtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgbGV0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgcm93LmNsYXNzTGlzdC5hZGQoXCJyb3ctcDFcIik7XG4gICAgcm93LnNldEF0dHJpYnV0ZShcImlkXCIsIGBwMS1yb3cke2l9YCk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItYm9hcmRcIikuYXBwZW5kQ2hpbGQocm93KTtcblxuICAgIHAxLmJvYXJkLmJvYXJkW2ldLmZvckVhY2goKGUsIGopID0+IHtcbiAgICAgIGxldCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcImNlbGwtcDFcIik7XG4gICAgICBjZWxsLnNldEF0dHJpYnV0ZShcImlkXCIsIGBwMS1yb3cke2l9LWNlbGwke2p9YCk7XG4gICAgICByb3cuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgfSk7XG4gIH1cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgbGV0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgcm93LmNsYXNzTGlzdC5hZGQoXCJyb3ctcDJcIik7XG4gICAgcm93LnNldEF0dHJpYnV0ZShcImlkXCIsIGBwMi1yb3cke2l9YCk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5vcC1ib2FyZFwiKS5hcHBlbmRDaGlsZChyb3cpO1xuXG4gICAgcDIuYm9hcmQuYm9hcmRbaV0uZm9yRWFjaCgoZSwgaikgPT4ge1xuICAgICAgbGV0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwiY2VsbC1wMlwiKTtcbiAgICAgIGNlbGwuc2V0QXR0cmlidXRlKFwiaWRcIiwgYHAyLXJvdyR7aX0tY2VsbCR7an1gKTtcbiAgICAgIHJvdy5hcHBlbmRDaGlsZChjZWxsKTtcblxuICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgICAgcmVuZGVyQXR0YWNrUDEoZSwgaSwgaiwgcDEsIHAyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG59XG5cbmZ1bmN0aW9uIHJlbmRlckZsZWV0KHBsYXllcikge1xuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmNlbGwtcDFcIikuZm9yRWFjaCgoZSwgaSkgPT4ge1xuICAgIGxldCB4LCB5O1xuICAgIGxldCBwb3MgPSBcIlwiICsgaTtcblxuICAgIGlmIChpIDwgMTApIHtcbiAgICAgIHggPSAwO1xuICAgICAgeSA9IGk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBvcyA9IHBvcy5zcGxpdChcIlwiKTtcbiAgICAgIHggPSBwb3NbMF07XG4gICAgICB5ID0gcG9zWzFdO1xuICAgIH1cblxuICAgIGlmICghcGxheWVyLmJvYXJkLmJvYXJkW3hdW3ldKSByZXR1cm47XG4gICAgZWxzZSBlLmNsYXNzTGlzdC5hZGQoXCJmbGVldFwiKTtcbiAgfSk7XG59XG5mdW5jdGlvbiByZW5kZXJBdHRhY2tQMShlLCBwb3MxLCBwb3MyLCBwMSwgcDIpIHtcbiAgbGV0IGF0dGFjayA9IHAxLmF0ayhwMiwgcG9zMSwgcG9zMik7XG4gIGlmICghYXR0YWNrKSByZXR1cm47XG4gIGlmIChhdHRhY2sgPT09IFwibWlzc1wiKSBlLnRhcmdldC5jbGFzc0xpc3QuYWRkKFwibWlzc1wiKTtcbiAgaWYgKGF0dGFjayA9PT0gXCJoaXRcIikge1xuICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5hZGQoXCJoaXRcIik7XG4gICAgcDIuYm9hcmQuYm9hcmRbcG9zMV1bcG9zMl0uc2hpcC5kb21UYXJnZXRzLnB1c2goZS50YXJnZXQpO1xuXG4gICAgaWYgKHAyLmJvYXJkLmJvYXJkW3BvczFdW3BvczJdLnNoaXAuaXNTdW5rKCkpXG4gICAgICBwMi5ib2FyZC5ib2FyZFtwb3MxXVtwb3MyXS5zaGlwLmRvbVRhcmdldHMuZm9yRWFjaCgoZSkgPT5cbiAgICAgICAgZS5jbGFzc0xpc3QuYWRkKFwic3Vua1wiKVxuICAgICAgKTtcbiAgICByZXR1cm47XG4gIH1cbn1cblxuZXhwb3J0IHsgcmVuZGVyQm9hcmRzLCByZW5kZXJGbGVldCB9O1xuIiwiaW1wb3J0IFBsYXllciBmcm9tIFwiLi9wbGF5ZXJcIjtcbmltcG9ydCB7IHJlbmRlckJvYXJkcywgcmVuZGVyRmxlZXQgfSBmcm9tIFwiLi9ET01cIjtcbmxldCBwMSA9IFBsYXllcihcIm1lXCIpO1xubGV0IHAyID0gUGxheWVyKFwiYWlcIik7XG5yZW5kZXJCb2FyZHMocDEsIHAyKTtcbnAxLnJhbmRGbGVldCgpO1xucDIucmFuZEZsZWV0KCk7XG5yZW5kZXJGbGVldChwMSk7XG4iXSwibmFtZXMiOlsibmFtZSIsImJvYXJkIiwibWlzc2VkU2hvdHMiLCJpIiwiaiIsInB1c2giLCJ2YWxpZFBsYWNlbWVudCIsImxlbmd0aCIsIngiLCJ5IiwiZGlyIiwiaGFzT3duUHJvcGVydHkiLCJwbGFjZVNoaXAiLCJzaGlwIiwic2l6ZSIsInNoaXBBcnIiLCJoaXQiLCJnZXRMZW5ndGgiLCJwb3MiLCJpc1N1bmsiLCJldmVyeSIsImRvbVRhcmdldHMiLCJzaGlwUG9zIiwicmVjZWl2ZUF0dGFjayIsImFsbFNoaXBzU3VuayIsImNoZWNrU2hpcHMiLCJyb3ciLCJzcGFjZSIsInR1cm4iLCJyYW5kU2hpcCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInJvdW5kIiwicGxheWVyVHVybiIsIm9wIiwiYXRrIiwicGxheWVyIiwicmFuZEZsZWV0IiwicmVuZGVyQXR0YWNrUDEiLCJlIiwicG9zMSIsInBvczIiLCJwMSIsInAyIiwiYXR0YWNrIiwidGFyZ2V0IiwiY2xhc3NMaXN0IiwiYWRkIiwiZm9yRWFjaCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsInF1ZXJ5U2VsZWN0b3IiLCJhcHBlbmRDaGlsZCIsImNlbGwiLCJhZGRFdmVudExpc3RlbmVyIiwicmVuZGVyQm9hcmRzIiwicXVlcnlTZWxlY3RvckFsbCIsInNwbGl0IiwicmVuZGVyRmxlZXQiXSwic291cmNlUm9vdCI6IiJ9